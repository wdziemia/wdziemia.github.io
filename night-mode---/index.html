<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Night Mode ++</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="../assets/main/css/main.css?v=780b19055e">
    <link rel="stylesheet" type="text/css" href="../assets/main/css/prism.css?v=780b19055e"> 

    <link rel="canonical" href="https://medium.com/@wdziemia/night-mode-79723ced5d14">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp/index.html">
    
    <meta property="og:site_name" content="Wojciech Dziemianczyk">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Night Mode ++">
    <meta property="og:description" content="Don’t blind your users at 1am, Implement night mode today!">
    <meta property="og:url" content="https://medium.com/@wdziemia/night-mode-79723ced5d14">
    <meta property="og:image" content="//wdziemia.github.io/content/images/downloaded_images/Night-Mode---/1-Ba8Qplz0rzqiU3Mi47BdNA.png">
    <meta property="article:published_time" content="2018-12-06T00:00:00.000Z">
    <meta property="article:modified_time" content="2020-12-23T17:50:03.000Z">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Night Mode ++">
    <meta name="twitter:description" content="Don’t blind your users at 1am, Implement night mode today!">
    <meta name="twitter:url" content="https://medium.com/@wdziemia/night-mode-79723ced5d14">
    <meta name="twitter:image" content="//wdziemia.github.io/content/images/downloaded_images/Night-Mode---/1-Ba8Qplz0rzqiU3Mi47BdNA.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Walter Dziemianczyk">
    <meta name="twitter:site" content="@wdziemia">
    <meta name="twitter:creator" content="@wdziemia">
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="304">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Wojciech Dziemianczyk",
        "url": "//wdziemia.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "//wdziemia.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Walter Dziemianczyk",
        "image": {
            "@type": "ImageObject",
            "url": "//wdziemia.github.io/content/images/2020/12/Group-1.png",
            "width": 433,
            "height": 433
        },
        "url": "//wdziemia.github.io/author/wdziemia/",
        "sameAs": [
            "https://twitter.com/wdziemia"
        ]
    },
    "headline": "Night Mode ++",
    "url": "//wdziemia.github.io/night-mode---/",
    "datePublished": "2018-12-06T00:00:00.000Z",
    "dateModified": "2020-12-23T17:50:03.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "//wdziemia.github.io/content/images/downloaded_images/Night-Mode---/1-Ba8Qplz0rzqiU3Mi47BdNA.png",
        "width": 800,
        "height": 304
    },
    "description": "Don’t blind your users at 1am, Implement night mode today!\n",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "//wdziemia.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.40">
    <link rel="alternate" type="application/rss+xml" title="Wojciech Dziemianczyk" href="../rss/index.rss">

</head>
<body class="is-preload post-template">

    <div id="wrapper">
        <main id="main">
            <div class="inner">

                
<section>

    <header class="main content">
        <span class="date">December 6, 2018</span>
        <h1>Night Mode ++</h1>
            <p class="content">Don’t blind your users at 1am, Implement night mode today!
</p>
    </header>

    <div class="image main"><img src="../content/images/downloaded_images/Night-Mode---/1-Ba8Qplz0rzqiU3Mi47BdNA.png" alt="Night Mode ++"></div>

    <div class="content">
        <p>Looking at an email at 1:00am and having your eyes crawl back into your brain is exactly why implementing night-mode is a great thing to do for your users. Not only that, there are benefits for battery when your user’s device is running an OLED panel!</p><p>If you are at the start of implementing night mode, I’d suggesting reading <a href="https://medium.com/androiddevelopers/appcompat-v23-2-daynight-d10f90c83e94">this article by Chris Banes</a>, to give you some context and a quick run-through of what you need to do!</p><p>You can also take a look at a <a href="https://github.com/wdziemia/Nightmode">basic example on Github</a>! </p><hr><p>Many Google Apps ship with night-mode controls now-a-days. Some are auto-magical, some are a simple on-off settings, and others are on steroids. Let’s take the simplest case.</p><p>If you’re on Android Pie, you can have the mode follow the system setting. All you need to do is the following:</p><p>1.) Extend your app-theme from DayNight</p><pre><code>@style/Theme.AppCompat.DayNight</code></pre><p>2.) Implement a custom <code>Application</code> class and set the default mode.</p><pre><code class="language-kotlin">AppCompatDelegate.setDefaultNightMode(MODE_NIGHT_FOLLOW_SYSTEM)</code></pre><hr><p>Ok, simple! Let’s get even crazier! <strong>What if we want to auto-magically change mode when it’s night in</strong><em><strong> real-life</strong></em><strong>?</strong></p><p>1.) In our <code>Application</code>, we just need to change the flag we pass into <code>AppCompatDelegate</code> to <code>MODE_NIGHT_AUTO</code></p><p>2.) <strong>Optional: </strong>Add coarse location permission to your manifest. This permission allows for a more precise toggle time. This is <strong>not </strong>necessary, but you will notice your app not aligning with other apps that might have this permission.</p><pre><code class="language-xml">&lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/&gt;</code></pre><hr><p>Huh, ok! <strong>So what if I just want to enable night mode to keep some juice in the battery?</strong></p><p>The <code>PowerManager</code> class can tell you if the device is in power-saver mode. You can call <code>PowerManager.isPowerSaveMode()</code> which will return a <code>Boolean</code> . If the <code>Boolean</code> is <code>true</code>, we need enable night mode, if <code>false</code> we disable it. So .. same location in our <code>Application</code> class:</p><pre><code class="language-kotlin">val nightMode = if (powerManager.isPowerSaveMode) MODE_NIGHT_YES else MODE_NIGHT_NO
AppCompatDelegate.setDefaultNightMode(nightMode)</code></pre><p>Great, but adding that change only applies to the instant the <code>Application</code> is created,<strong> how do we react to power-saver dynamically?</strong></p><p>We need to listen to an Intent being broadcast, globally, with an Action of <code>android.os.action.POWER_SAVE_MODE_CHANGED</code>. If we are listening dynamically, we will already be within our launcher/main <code>Activity</code>. We will need to register a <code>BroadcastReceiver</code> within that <code>Activity</code> to react to this change. When that <code>Intent</code> is broadcast, we’ll invoke a method in the <code>Activity</code> to change the value in `AppCompatDelegate` along with on the <code>Activity</code> via its delegate .</p><pre><code class="language-kotlin">private fun onPowerSaverChanged() {
    val nightMode = if (powerManager.isPowerSaveMode) MODE_NIGHT_YES else MODE_NIGHT_NO
    AppCompatDelegate.setDefaultNightMode(nightMode)
    delegate.setLocalNightMode(nightMode)
}</code></pre><p>The <code>Activity</code>’s delegate will then automagically recreate the <code>Activity</code> in order to apply night mode. This is probably a good time to make sure your UI is restoring state properly!</p><hr><p>Good job, You’ve implemented everything you’ve needed to get the following menu in your settings screen:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="../content/images/downloaded_images/Night-Mode---/1-tXozpcB1nFcMQwMbUlVC-g.png" class="kg-image" alt><figcaption>Google News dark-theme preference</figcaption></figure><p><strong>So, how do I now control this through settings?</strong></p><p>Many different ways! You could have a helper class which is solely responsible for determining the value to pass through to <code>AppCompatDelegate</code> and your <code>Activity</code>’s delegate. It’s just a matter of telling an <code>Activity</code> that the setting has changed from there. You could do this using a <code>LocalBroadcastManager</code>. Not glamorous, but it’ll work! Your <code>Activity</code> could listen for a local broadcast sent from your settings screen and apply the changes needed.</p><p>If every <code>Activity</code> extends from the same base class, you could have a method to apply night-mode when that setting has changed. This same method can be called when power-saver mode changes as well!</p><pre><code class="language-kotlin">private fun applyNightMode() {
    val nightMode = settingsHelper.getNightModeValue()
    AppCompatDelegate.setDefaultNightMode(nightMode)
    delegate.setLocalNightMode(nightMode)
}</code></pre><p>Ba-da-boom, you now have night-mode on steroids!</p><p>Enjoy &amp; Happy Coding!

</p>
    </div>


    <footer class="post-footer">
        <div><a href="//twitter.com/wdziemia">— @wdziemia</a></div>
    </footer>
    
    

    


</section>

<script>
    var images = document.querySelectorAll('.kg-gallery-image img');
    images.forEach(function (image) {
        var container = image.closest('.kg-gallery-image');
        var width = image.attributes.width.value;
        var height = image.attributes.height.value;
        var ratio = width / height;
        container.style.flex = ratio + ' 1 0%';
    })
</script>


            </div>
        </main>

        <div id="sidebar">
    <div class="inner">

              
                <section class="author-header">
                        <img class="author-profile-image" src="../content/images/2020/12/Group-1.png" alt="Walter Dziemianczyk">
                    <h5><a href="../author/wdziemia/index.html">Walter Dziemianczyk</a></h5>       
                        <p class="content">Senior Software Engineer <span class="bull">•</span> <a href="//wdziemia.github.io/night-mode---/www.twiter.com/NYTimes">@NYTimes</a></p>

                    <div class="author-location icon fa-map-pin">New York, New York</div>

                </section>
            

            <nav id="menu">
    <header class="major">
        <h2>Menu</h2>
    </header>
    <ul class="links">
        <li class="nav-home "><a href="../index.html">Home</a></li>
    </ul>
</nav>

        <section id="menu">
            <header class="major">
                <h2>Links</h2>
            </header>
            <ul class="links">
                <li><a href="https://github.com/wdziemia">Github</a></li>
                <li><a href="https://www.linkedin.com/in/walter-dziemianczyk-3308035b/">LinkedIn</a></li>
                <li><a href="https://twitter.com/wdziemia">Twitter</a></li>
                <li><a href="https://feedly.com/i/subscription/feed///wdziemia.github.io/rss/index.rss">Linkify</a></li>
            </ul>
        </section>

        <section id="menu">
            <header class="major">
                <h2>Projects</h2>
            </header>
            <ul class="links">
                <li><a href="https://window.dziemia.com">Window VQA</a></li>
                <li><a href="https://github.com/wdziemia/wdziemia.github.io">Blog</a></li>
            </ul>
        </section>

        <footer id="footer">
            <p class="copyright">© 2020 Wojciech Dziemianczyk
        </p></footer>

    </div>
</div>

    </div>

    <script src="../assets/main/js/jquery.min.js?v=780b19055e"></script>
    <script src="../assets/main/js/browser.min.js?v=780b19055e"></script>
    <script src="../assets/main/js/breakpoints.min.js?v=780b19055e"></script>
    <script src="../assets/main/js/util.js?v=780b19055e"></script>
    <script src="../assets/main/js/main.js?v=780b19055e"></script>
    <script src="../assets/main/js/prism.js?v=780b19055e"></script>

    

</body>
</html>